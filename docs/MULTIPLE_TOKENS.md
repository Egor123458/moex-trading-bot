# üîë –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤ Tinkoff

## ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏ Tinkoff –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–µ–π –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ .env —Ñ–∞–π–ª–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```env
TINKOFF_TOKENS=token1_–∑–¥–µ—Å—å,token2_–∑–¥–µ—Å—å,token3_–∑–¥–µ—Å—å
TINKOFF_ACCOUNT_ID=–≤–∞—à_account_id
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ —Ç–æ—á–∫—É —Å –∑–∞–ø—è—Ç–æ–π

```env
TINKOFF_TOKENS=token1_–∑–¥–µ—Å—å;token2_–∑–¥–µ—Å—å;token3_–∑–¥–µ—Å—å
TINKOFF_ACCOUNT_ID=–≤–∞—à_account_id
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ (–≤ —Ñ–∞–π–ª–µ)

```env
TINKOFF_TOKENS=token1_–∑–¥–µ—Å—å
token2_–∑–¥–µ—Å—å
token3_–∑–¥–µ—Å—å
TINKOFF_ACCOUNT_ID=–≤–∞—à_account_id
```

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç `TINKOFF_TOKEN` —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è (–±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ –ø–µ—Ä–≤—ã–π —Ç–æ–∫–µ–Ω):

```env
TINKOFF_TOKEN=token_–∑–¥–µ—Å—å
TINKOFF_ACCOUNT_ID=–≤–∞—à_account_id
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–†–æ—Ç–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤**: –¢–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ –∫—Ä—É–≥—É (round-robin) –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**: –ü—Ä–∏ –æ—à–∏–±–∫–µ —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π
3. **–û—Ç–º–µ—Ç–∫–∞ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏—Ö**: –¢–æ–∫–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–∫–ª—é—á–∞—é—Ç—Å—è –∏–∑ —Ä–æ—Ç–∞—Ü–∏–∏
4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ù–µ—É–¥–∞—á–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–µ

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```python
from src.data_collection.tinkoff_api import TinkoffAPIClient
from config.settings import settings

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TokenManager –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ç–æ–∫–µ–Ω–∞
client = TinkoffAPIClient(account_id=settings.api.TINKOFF_ACCOUNT_ID)

# –í—Å–µ –º–µ—Ç–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ –¥—Ä—É–≥–æ–π —Ç–æ–∫–µ–Ω –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
portfolio = client.get_portfolio()
candles = client.get_candles(figi, from_date, to_date)
```

### –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏

```python
from src.utils.token_manager import token_manager

# –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
token = token_manager.get_token(strategy='round_robin')  # –ü–æ –∫—Ä—É–≥—É
token = token_manager.get_token(strategy='random')        # –°–ª—É—á–∞–π–Ω—ã–π
token = token_manager.get_token(strategy='first')        # –ü–µ—Ä–≤—ã–π

# –ü–æ–º–µ—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –∫–∞–∫ –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∏–π
token_manager.mark_token_failed(token)

# –ü–æ–º–µ—Ç–∏—Ç—å —Ç–æ–∫–µ–Ω –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—â–∏–π
token_manager.mark_token_working(token)

# –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã
all_tokens = token_manager.get_all_tokens()

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
available = token_manager.get_available_count()
```

## üìù –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è 2 —Ç–æ–∫–µ–Ω–æ–≤

–í —Ñ–∞–π–ª–µ `/opt/moex_trading_bot/.env`:

```env
# –î–≤–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
TINKOFF_TOKENS=t.your_first_token_here,t.your_second_token_here

# ID —Å—á–µ—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å –æ–¥–∏–Ω –¥–ª—è –æ–±–æ–∏—Ö –∏–ª–∏ —Ä–∞–∑–Ω—ã–µ)
TINKOFF_ACCOUNT_ID=your_account_id

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DATABASE_URL=postgresql://admin:Admin123456@10.0.0.129:5432/trading_bot
MODE=paper_trading
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```python
from config.settings import settings

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
print(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤: {len(settings.api.get_all_tokens())}")
for i, token in enumerate(settings.api.get_all_tokens()):
    print(f"–¢–æ–∫–µ–Ω {i+1}: {token[:10]}...")  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env` —Ñ–∞–π–ª –≤ Git! –û–Ω —É–∂–µ –≤ `.gitignore`
2. **–õ–∏–º–∏—Ç—ã API**: –ö–∞–∂–¥—ã–π —Ç–æ–∫–µ–Ω –∏–º–µ–µ—Ç —Å–≤–æ–∏ –ª–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
3. **–°—á–µ—Ç–∞**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫ –Ω—É–∂–Ω—ã–º —Å—á–µ—Ç–∞–º
4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ü—Ä–∏ —Å–±–æ–µ –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–æ–π
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É —Ç–æ–∫–µ–Ω–∞–º–∏
- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**: –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –æ–¥–Ω—É –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

